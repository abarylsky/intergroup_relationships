---
title             : "The title"
shorttitle        : "Title"

author: 
  - name          : "First Author"
    affiliation   : "1"
    corresponding : yes    # Define only one corresponding author
    address       : "Postal address"
    email         : "my@email.com"
  - name          : "Ernst-August Doelle"
    affiliation   : "1,2"

affiliation:
  - id            : "1"
    institution   : "Wilhelm-Wundt-University"
  - id            : "2"
    institution   : "Konstanz Business School"
  
keywords          : "keywords"
wordcount         : "X"

bibliography      : ["r-references.bib"]

floatsintext      : no
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
library("papaja")
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
library(psysds364data)
library(tidyverse)
library(sjlabelled)
library(psych)
library(skimr)
data("Goldberg_gav")
```


```{r define_subset}
var_labels <- data.frame(column_name = colnames(Goldberg_gav),
                         variable_label = sjlabelled::get_label(Goldberg_gav))

Goldberg_gav_sm <- Goldberg_gav %>%
  select(ID,
         Partner,
         group,
         ChildAge,
         chgend,
         gendexp,
         gender,
         sexor,
         w11RelDur,
         contains("chrace"),
         religion,
         howrelig,
         contains("otherch"),
         occup,
         contains("otherwork"),
         educ,
         faminc,
         paraccme_5,
         contains("polit"),
         contains("gayaff"),
         cityst,
         contains("genderparent"),
         sexor,
         contains("myrace"),
         contains("h12"),
         contains("w12"),
         h12social,
         h12selfdir,
         h12conform,
         contains("soccomp"),
         SocComp,
         Prosocial,
         Emotional
         )

#exclude individuals who do not have data for parental values or social competence

#find the subset of dyads who have information for both people for all of the variables
Goldberg_gav_completes <- Goldberg_gav_sm %>%
  filter(!is.na(SocComp) & !is.na(Prosocial) & !is.na(Emotional) & !is.na(h12social) & !is.na(h12selfdir) & !is.na(h12conform)) %>%
  group_by(ID) %>%
  count() %>%
  filter(n == 2)

#join this subset with the full set of individuals
Goldberg_gav_sm <- Goldberg_gav_sm %>%
  inner_join(Goldberg_gav_completes, by = "ID")
```

```{r impute_data}
Goldberg_gav_sm <- Goldberg_gav_sm %>%
  mutate(gender = ifelse(gender == 3, 1, gender))

Goldberg_gav_sm$gender[is.na(Goldberg_gav_sm$gender)] <- 1

#impute ID 231 partner 2's relationship duration
Goldberg_gav_sm <- Goldberg_gav_sm %>%
  mutate(w11RelDur = ifelse(ID == 231 & Partner == 2, 7.0, w11RelDur))
```

```{r subset_by_group}
lesbians <- Goldberg_gav_sm %>%
  filter(group == 1)

gays <- Goldberg_gav_sm %>%
  filter(group == 2)

straight_men <- Goldberg_gav_sm %>%
  filter(group == 3 & gender == 2)

straight_women <- Goldberg_gav_sm %>%
  filter(group == 3 & gender == 1)
```

```{r counts_labels}
counts_labels <- function(data, x) {
  #if factor convert to numeric
  dims <- dim(data)
  counts <- data %>%
    select_(x) %>%
    group_by_(x) %>%
    count_()
  labels <- tibble(variable_label = 
                     get_labels(data[[x]]))
  data.table::setDT(labels, keep.rownames = TRUE)[]
  labels$rn <- as.numeric(labels[,rn])
  names(counts)[1] <- "x"
  x_bins <- counts %>%
    right_join(labels, by = c("x" = "rn"))
  names(x_bins)[1] <- c(x, "n", "variable_label")
  x_bins[["n"]][is.na(x_bins[["n"]])] <- 0
  x_bins <- x_bins %>%
    mutate(percent = round((n / dims[[1]]) * 100))
  x_bins <- x_bins %>%
    select(1, variable_label, everything())
  return(x_bins)
}
```

```{r sexor_counts}
sexor_counts <- counts_labels(Goldberg_gav_sm, "sexor")
```


The current sample includes `r dim(Goldberg_gav_sm)[1]` participants and `r (dim(Goldberg_gav_sm)[1]) / 2`, including `r (dim(lesbians)[1]) / 2` female same-sex couples, `r (dim(gays)[1]) / 2` male same-sex couples, and `r dim(straight_women)[1]` heterosexual couples. The sample was determined by excluding any participants who did not have data for the primary variables of interest: Parental Values and Social Competence. Thus, any dyad that does not have information from both partners in the relevant variables was excluded.

Out of the `r dim(Goldberg_gav_sm)[1]` participants, `r dim(filter(Goldberg_gav_sm, gender == 1))[1]` are female and `r dim(filter(Goldberg_gav_sm, gender == 2))[1]` are male. In this subset of participants, `r pluck(sexor_counts, 4, 1)`% (n = `r pluck(sexor_counts, 3, 1)`) identify as "`r pluck(sexor_counts, 2, 1)`", `r pluck(sexor_counts, 4, 2)`% (n = `r pluck(sexor_counts, 3, 2)`) identify as "`r pluck(sexor_counts, 2, 2)`", `r pluck(sexor_counts, 4, 3)`% (n = `r pluck(sexor_counts, 3, 3)`) identify as "`r pluck(sexor_counts, 2, 3)`", `r pluck(sexor_counts, 4, 4)`% (n = `r pluck(sexor_counts, 3, 4)`) identify as "`r pluck(sexor_counts, 2, 4)`", `r pluck(sexor_counts, 4, 5)`% (n = `r pluck(sexor_counts, 3, 5)`) identify as "`r pluck(sexor_counts, 2, 5)`", `r pluck(sexor_counts, 4, 6)`% (n = `r pluck(sexor_counts, 3, 6)`) identify as "`r pluck(sexor_counts, 2, 6)`", and `r pluck(sexor_counts, 4, 7)`% (n = `r pluck(sexor_counts, 3, 7)`) identify as "`r pluck(sexor_counts, 2, 7)`".





\newpage

# References
```{r create_r-references}
r_refs(file = "r-references.bib")
```

\begingroup
\setlength{\parindent}{-0.5in}
\setlength{\leftskip}{0.5in}

<div id = "refs"></div>
\endgroup
